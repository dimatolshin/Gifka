import{u as R,b as U,m as w,g as J,r as i,j as t}from"./index-27cacaf7.js";import{B as d}from"./Button-84c75981.js";import{s as a}from"./OldImageAdmin.module-21041e04.js";import{D as X}from"./cjs-521985a1.js";import{l as Y,u as Z,G as ee,g as te,e as se}from"./dataImg-893cbd10.js";import{u as ae,a as m,q as r}from"./queryClient-5637703c.js";import{_ as g}from"./index-5cabf26d.js";import{L as ne}from"./ListFilter-aab71a08.js";import{g as ie}from"./getAdminGif-8fba910d.js";import"./ListBox-3d27fbe8.js";const xe=()=>{const z={country:"",language:"",currency:"",banner_format:"",banner_theme:""},A=R(ie),E=U(),{full_picture_id:I}=w(),{t:q}=ae(),s=A.find(e=>e.full_picture_id===Number(I)),v=R(J),[y,j]=i.useState(),p=i.useRef(null),[l,S]=i.useState({x:0,y:0}),[N,k]=i.useState("Тест текст"),[f,P]=i.useState("30"),[x,b]=i.useState("#000000"),[C,B]=i.useState(1),[D,F]=i.useState(1e3),[c,h]=i.useState([{id:1,selectedValues:z}]);i.useEffect(()=>{s&&(P(s.size),b(s.color_text),S({x:s.left,y:s.top}),B(s.start_frame),F(s.end_frame),h([{id:1,selectedValues:{country:s.country||"",language:s.language||"",currency:s.value||"",banner_format:s.format||"",banner_theme:s.topic||""}}]))},[s]);const V=m({mutationFn:e=>Z(e.pictures),onSuccess:()=>{r.invalidateQueries({queryKey:["adminGif"]})},onError:e=>{g.error(e.message)}},r),G=m({mutationFn:e=>ee(e.token,e.full_picture_id),onSuccess:e=>{j(e)},onError:e=>{g.error(e.message)}},r),$=m({mutationFn:e=>te(e.full_picture_id),onSuccess:e=>{r.invalidateQueries({queryKey:["adminGif"]}),g.success(e.data)}},r),K=e=>{$.mutate({full_picture_id:e})},L=m({mutationFn:e=>se(e.token,e.full_picture_id),onSuccess:e=>{E(-1),r.invalidateQueries({queryKey:["adminGif"]}),g.success(e.Success)}},r),Q=e=>{L.mutate({token:v,full_picture_id:e})},T=(e,n)=>{S({x:n.x,y:n.y})},H=(e,n,_)=>{h(c.map(o=>o.id===e?{...o,selectedValues:{...o.selectedValues,[n]:_}}:o))},W=()=>{const e=p.current;if(e){const n=e.offsetWidth,_=e.offsetHeight,o=c.map(u=>({full_picture_id:s.full_picture_id,country:u.selectedValues.country,language:u.selectedValues.language,value:u.selectedValues.currency,format:u.selectedValues.banner_format,topic:u.selectedValues.banner_theme,color:x,left:l.x.toString(),right:(l.x+n).toString(),top:l.y.toString(),bottom:(l.y+_).toString(),size:f,start_frame:C,end_frame:D}));V.mutate({pictures:o})}},M=e=>{j(null),G.mutate({token:v,full_picture_id:e})},O=e=>h(c.filter(n=>n.id!==e));return t.jsxs("div",{className:a.redactorBox,children:[t.jsxs("div",{className:a.draggableImgBox,children:[t.jsx(X,{nodeRef:p,bounds:"parent",position:l,onDrag:T,children:t.jsx("div",{ref:p,className:a.draggableBox,style:{fontSize:`${f}px`,color:x},children:N})}),s.url&&t.jsx("img",{className:a.redactorImg,src:s.url,alt:"img"})]}),t.jsxs("div",{className:a.controls,children:[t.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:N,onChange:e=>k(e.target.value),placeholder:"Введите текст"}),t.jsx("input",{className:`${a.size} ${a.inputAdmin}`,type:"number",value:f,onChange:e=>P(e.target.value),placeholder:"Размер шрифта"}),t.jsx("input",{className:a.color,type:"color",value:x,onChange:e=>b(e.target.value)}),t.jsxs("div",{children:[t.jsx("p",{children:"Начало анимации*кадры*"}),t.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:C,onChange:e=>{B(Number(e.target.value))},placeholder:"Начало анимации"}),t.jsx("p",{children:"Конец анимации*кадры*"}),t.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:D,onChange:e=>{F(Number(e.target.value))},placeholder:"Конец анимации"})]})]}),c.map((e,n)=>t.jsx(ne,{index:n,block:e,listBoxItems:Y,handleListBoxChange:H,removeBlock:O,t:q},e.id)),s.is_publish?t.jsx("div",{children:"Опубликовано"}):t.jsx("div",{children:"Не опубликовано"}),t.jsxs("div",{className:a.btnBox,children:[t.jsx(d,{isLoading:V.isPending,className:a.adminRedactorButton,onClick:W,children:"Изменить"}),t.jsx(d,{isLoading:G.isPending,className:a.adminRedactorButton,onClick:()=>M(s.full_picture_id),children:"Demo"}),t.jsx(d,{isLoading:$.isPending,className:a.adminRedactorButton,onClick:()=>K(s.full_picture_id),children:"Опубликовать"}),t.jsx(d,{isLoading:L.isPending,className:a.btnDelete,onClick:()=>Q(s.full_picture_id),children:"Удалить"})]}),y&&t.jsx("img",{src:y,alt:""})]})};export{xe as default};
