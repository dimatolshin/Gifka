import{u as A,m as L,b as P,r as o,j as t}from"./index-27cacaf7.js";import{g as E}from"./getAdminImg-09967c00.js";import{s,L as F}from"./ListFilter-aab71a08.js";import{D as H}from"./cjs-521985a1.js";import{B as y}from"./Button-84c75981.js";import{l as K,u as Q}from"./dataImg-893cbd10.js";import{u as T,a as W,q as x}from"./queryClient-5637703c.js";import{_ as w}from"./index-5cabf26d.js";import"./ListBox-3d27fbe8.js";const ee=()=>{const j=A(E),{t:N}=T(),{picture_id:S}=L(),B=P(),c=o.useRef(null),u=j.find(e=>e.picture_id===Number(S)),[i,V]=o.useState({x:0,y:0}),[f,b]=o.useState("Тест текст"),[d,_]=o.useState(30),[m,C]=o.useState("#000000"),h=W({mutationFn:e=>Q(e.pictures),onSuccess:()=>{B(-1),x.invalidateQueries({queryKey:["img"]}),x.invalidateQueries({queryKey:["adminGif"]})},onError:e=>{w.error(e.message)}},x),v={country:"",language:"",currency:"",banner_format:"",banner_theme:""},[r,g]=o.useState([{id:1,selectedValues:v}]),I=(e,a)=>{V({x:a.x,y:a.y})},R=()=>{g([...r,{id:r.length+1,selectedValues:v}])},z=(e,a,p)=>{g(r.map(n=>n.id===e?{...n,selectedValues:{...n.selectedValues,[a]:p}}:n))},D=()=>r.every(e=>Object.values(e.selectedValues).every(a=>a!=="")),$=()=>{if(!D()){alert("Все поля должны быть заполнены!");return}const e=c.current;if(e){const a=e.offsetWidth,p=e.offsetHeight,n=r.map(l=>({picture_id:u.picture_id,country:l.selectedValues.country,language:l.selectedValues.language,value:l.selectedValues.currency,format:l.selectedValues.banner_format,topic:l.selectedValues.banner_theme,color:m,left:i.x.toString(),right:(i.x+a).toString(),top:i.y.toString(),bottom:(i.y+p).toString(),size:d}));h.mutate({pictures:n})}},q=e=>g(r.filter(a=>a.id!==e));return t.jsxs("div",{className:s.redactorBox,children:[t.jsxs("div",{className:s.draggableImgBox,children:[t.jsx(H,{nodeRef:c,bounds:"parent",position:i,onDrag:I,children:t.jsx("div",{ref:c,className:s.draggableBox,style:{fontSize:`${d}px`,color:m},children:f})}),u.url&&t.jsx("img",{className:s.redactorImg,src:u.url,alt:"img"})]}),t.jsxs("div",{className:s.controls,children:[t.jsx("input",{className:`${s.text} ${s.inputAdmin}`,type:"text",value:f,onChange:e=>b(e.target.value),placeholder:"Введите текст"}),t.jsx("input",{className:`${s.size} ${s.inputAdmin}`,type:"number",value:d,onChange:e=>_(Number(e.target.value)),placeholder:"Размер шрифта"}),t.jsx("input",{className:s.color,type:"color",value:m,onChange:e=>C(e.target.value)})]}),r.map((e,a)=>t.jsx(F,{index:a,block:e,listBoxItems:K,handleListBoxChange:z,removeBlock:q,t:N},e.id)),t.jsxs("div",{className:s.btnBox,children:[t.jsx(y,{className:s.adminRedactorButton,onClick:R,children:"Добавить фильтр"}),t.jsx(y,{isLoading:h.isPending,className:s.adminRedactorButton,onClick:$,children:"Отправить"})]})]})};export{ee as default};
