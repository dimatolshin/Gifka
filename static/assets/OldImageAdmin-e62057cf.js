import{u as V,i as H,m as W,g as M,r as n,j as s}from"./index-3f4c7b3a.js";import{g as O}from"./getAdminImg-09967c00.js";import{B as d}from"./Button-52d16501.js";import{s as a}from"./OldImageAdmin.module-21041e04.js";import{D as U}from"./cjs-bfe49bfb.js";import{l as w,u as J,s as X,g as Y,e as Z}from"./dataImg-f31eeea1.js";import{u as ee,a as m,q as r}from"./queryClient-abb6bd5f.js";import{_ as g}from"./index-d006d8c5.js";import{L as te}from"./ListFilter-cacb8fbc.js";import"./ListBox-f859184e.js";const me=()=>{const I={country:"",language:"",currency:"",banner_format:"",banner_theme:""},L=V(O),R=H(),{full_picture_id:z}=W(),{t:F}=ee(),t=L.find(e=>e.full_picture_id===Number(z)),y=V(M),[q,v]=n.useState(),f=n.useRef(null),[l,j]=n.useState({x:0,y:0}),[S,E]=n.useState("Тест текст"),[p,P]=n.useState("30"),[x,N]=n.useState("#000000"),[u,_]=n.useState([{id:1,selectedValues:I}]);n.useEffect(()=>{t&&(P(t.size),N(t.color_text),j({x:t.left,y:t.top}),_([{id:1,selectedValues:{country:t.country||"",language:t.language||"",currency:t.value||"",banner_format:t.format||"",banner_theme:t.topic||""}}]))},[t]);const B=m({mutationFn:e=>J(e.pictures),onSuccess:()=>{r.invalidateQueries({queryKey:["img"]})},onError:e=>{g.error(e.message)}},r),C=m({mutationFn:e=>X(e.token,e.full_picture_id),onSuccess:e=>{v(e)},onError:e=>{g.error(e.message)}},r),D=m({mutationFn:e=>Y(e.full_picture_id),onSuccess:e=>{r.invalidateQueries({queryKey:["img"]}),g.success(e.data)}},r),$=e=>{D.mutate({full_picture_id:e})},b=m({mutationFn:e=>Z(e.token,e.full_picture_id),onSuccess:e=>{R(-1),r.invalidateQueries({queryKey:["img"]}),g.success(e.Success)}},r),A=e=>{b.mutate({token:y,full_picture_id:e})},k=(e,i)=>{j({x:i.x,y:i.y})},G=(e,i,h)=>{_(u.map(o=>o.id===e?{...o,selectedValues:{...o.selectedValues,[i]:h}}:o))},K=()=>{const e=f.current;if(e){const i=e.offsetWidth,h=e.offsetHeight,o=u.map(c=>({full_picture_id:t.full_picture_id,country:c.selectedValues.country,language:c.selectedValues.language,value:c.selectedValues.currency,format:c.selectedValues.banner_format,topic:c.selectedValues.banner_theme,color:x,left:l.x.toString(),right:(l.x+i).toString(),top:l.y.toString(),bottom:(l.y+h).toString(),size:p,start_frame:0,end_frame:0}));B.mutate({pictures:o})}},Q=e=>{v(null),C.mutate({token:y,full_picture_id:e})},T=e=>_(u.filter(i=>i.id!==e));return s.jsxs("div",{className:a.redactorBox,children:[s.jsxs("div",{className:a.draggableImgBox,children:[s.jsx(U,{nodeRef:f,bounds:"parent",position:l,onDrag:k,children:s.jsx("div",{ref:f,className:a.draggableBox,style:{fontSize:`${p}px`,color:x},children:S})}),t.url&&s.jsx("img",{className:a.redactorImg,src:t.url,alt:"img"})]}),s.jsxs("div",{className:a.controls,children:[s.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:S,onChange:e=>E(e.target.value),placeholder:"Введите текст"}),s.jsx("input",{className:`${a.size} ${a.inputAdmin}`,type:"number",value:p,onChange:e=>P(e.target.value),placeholder:"Размер шрифта"}),s.jsx("input",{className:a.color,type:"color",value:x,onChange:e=>N(e.target.value)})]}),u.map((e,i)=>s.jsx(te,{index:i,block:e,listBoxItems:w,handleListBoxChange:G,removeBlock:T,t:F},e.id)),t.is_publish?s.jsx("div",{children:"Опубликовано"}):s.jsx("div",{children:"Не опубликовано"}),s.jsxs("div",{className:a.btnBox,children:[s.jsx(d,{isLoading:B.isPending,className:a.adminRedactorButton,onClick:K,children:"Изменить"}),s.jsx(d,{isLoading:C.isPending,className:a.adminRedactorButton,onClick:()=>Q(t.full_picture_id),children:"Demo"}),s.jsx(d,{isLoading:D.isPending,className:a.adminRedactorButton,onClick:()=>$(t.full_picture_id),children:"Опубликовать"}),s.jsx(d,{isLoading:b.isPending,className:a.btnDelete,onClick:()=>A(t.full_picture_id),children:"Удалить"})]}),s.jsx("img",{src:q,alt:""})]})};export{me as default};
