import{u as q,m as G,i as H,r,j as s}from"./index-677d6519.js";import{s as t,L as T}from"./ListFilter-e203dd93.js";import{D as W}from"./cjs-2d298116.js";import{B as j}from"./Button-ca8c03f0.js";import{u as w,a as K,q as N}from"./queryClient-0bd66486.js";import{_ as M}from"./index-c0d55037.js";import{l as O,u as Q}from"./dataImg-46438f82.js";import{g as J}from"./getAdminGif-8fba910d.js";import"./ListBox-b75c6876.js";const re=()=>{const S=q(J),{t:B}=w(),{picture_id:_}=G(),b=H(),c=r.useRef(null),u=S.find(e=>e.picture_id===Number(_)),[o,C]=r.useState({x:0,y:0}),[x,V]=r.useState("Тест текст"),[d,$]=r.useState(30),[m,F]=r.useState("#000000"),[f,R]=r.useState(1),[h,A]=r.useState(1e3),v=K({mutationFn:e=>Q(e.pictures),onSuccess:()=>{b(-1),N.invalidateQueries({queryKey:["adminGif"]})},onError:e=>{M.error(e.message)}},N),y={country:"",language:"",currency:"",banner_format:"",banner_theme:""},[n,g]=r.useState([{id:1,selectedValues:y}]),z=(e,a)=>{C({x:a.x,y:a.y})},D=()=>{g([...n,{id:n.length+1,selectedValues:y}])},I=(e,a,p)=>{g(n.map(i=>i.id===e?{...i,selectedValues:{...i.selectedValues,[a]:p}}:i))},E=()=>n.every(e=>Object.values(e.selectedValues).every(a=>a!=="")),L=()=>{if(!E()){alert("Все поля должны быть заполнены!");return}const e=c.current;if(e){const a=e.offsetWidth,p=e.offsetHeight,i=n.map(l=>({picture_id:u.picture_id,country:l.selectedValues.country,language:l.selectedValues.language,value:l.selectedValues.currency,format:l.selectedValues.banner_format,topic:l.selectedValues.banner_theme,color:m,left:o.x.toString(),right:(o.x+a).toString(),top:o.y.toString(),bottom:(o.y+p).toString(),size:d,start_frame:f,end_frame:h}));v.mutate({pictures:i})}},P=e=>g(n.filter(a=>a.id!==e));return s.jsxs("div",{className:t.redactorBox,children:[s.jsxs("div",{className:t.draggableImgBox,children:[s.jsx(W,{nodeRef:c,bounds:"parent",position:o,onDrag:z,children:s.jsx("div",{ref:c,className:t.draggableBox,style:{fontSize:`${d}px`,color:m},children:x})}),u.url&&s.jsx("img",{className:t.redactorImg,src:u.url,alt:"img"})]}),s.jsxs("div",{className:t.controls,children:[s.jsx("input",{className:`${t.text} ${t.inputAdmin}`,type:"text",value:x,onChange:e=>V(e.target.value),placeholder:"Введите текст"}),s.jsx("input",{className:`${t.size} ${t.inputAdmin}`,type:"number",value:d,onChange:e=>$(Number(e.target.value)),placeholder:"Размер шрифта"}),s.jsx("input",{className:t.color,type:"color",value:m,onChange:e=>F(e.target.value)}),s.jsxs("div",{children:[s.jsx("input",{className:`${t.text} ${t.inputAdmin}`,type:"text",value:f,onChange:e=>{R(Number(e.target.value))},placeholder:"Начало анимации"}),s.jsx("input",{className:`${t.text} ${t.inputAdmin}`,type:"text",value:h,onChange:e=>{A(Number(e.target.value))},placeholder:"Конец анимации"})]})]}),n.map((e,a)=>s.jsx(T,{index:a,block:e,listBoxItems:O,handleListBoxChange:I,removeBlock:P,t:B},e.id)),s.jsxs("div",{className:t.btnBox,children:[s.jsx(j,{className:t.adminRedactorButton,onClick:D,children:"Добавить фильтр"}),s.jsx(j,{isLoading:v.isPending,className:t.adminRedactorButton,onClick:L,children:"Отправить"})]})]})};export{re as default};
