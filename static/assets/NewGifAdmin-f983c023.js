import{u as q,m as G,b as H,r,j as t}from"./index-27cacaf7.js";import{s,L as T}from"./ListFilter-aab71a08.js";import{D as W}from"./cjs-521985a1.js";import{B as j}from"./Button-84c75981.js";import{u as w,a as K,q as N}from"./queryClient-5637703c.js";import{_ as M}from"./index-5cabf26d.js";import{l as O,u as Q}from"./dataImg-893cbd10.js";import{g as J}from"./getAdminGif-8fba910d.js";import"./ListBox-3d27fbe8.js";const re=()=>{const S=q(J),{t:B}=w(),{picture_id:b}=G(),_=H(),c=r.useRef(null),u=S.find(e=>e.picture_id===Number(b)),[o,C]=r.useState({x:0,y:0}),[x,V]=r.useState("Тест текст"),[d,$]=r.useState(30),[m,F]=r.useState("#000000"),[f,R]=r.useState(1),[h,A]=r.useState(1e3),v=K({mutationFn:e=>Q(e.pictures),onSuccess:()=>{_(-1),N.invalidateQueries({queryKey:["adminGif"]})},onError:e=>{M.error(e.message)}},N),y={country:"",language:"",currency:"",banner_format:"",banner_theme:""},[n,g]=r.useState([{id:1,selectedValues:y}]),z=(e,a)=>{C({x:a.x,y:a.y})},D=()=>{g([...n,{id:n.length+1,selectedValues:y}])},I=(e,a,p)=>{g(n.map(i=>i.id===e?{...i,selectedValues:{...i.selectedValues,[a]:p}}:i))},E=()=>n.every(e=>Object.values(e.selectedValues).every(a=>a!=="")),L=()=>{if(!E()){alert("Все поля должны быть заполнены!");return}const e=c.current;if(e){const a=e.offsetWidth,p=e.offsetHeight,i=n.map(l=>({picture_id:u.picture_id,country:l.selectedValues.country,language:l.selectedValues.language,value:l.selectedValues.currency,format:l.selectedValues.banner_format,topic:l.selectedValues.banner_theme,color:m,left:o.x.toString(),right:(o.x+a).toString(),top:o.y.toString(),bottom:(o.y+p).toString(),size:d,start_frame:f,end_frame:h}));v.mutate({pictures:i})}},P=e=>g(n.filter(a=>a.id!==e));return t.jsxs("div",{className:s.redactorBox,children:[t.jsxs("div",{className:s.draggableImgBox,children:[t.jsx(W,{nodeRef:c,bounds:"parent",position:o,onDrag:z,children:t.jsx("div",{ref:c,className:s.draggableBox,style:{fontSize:`${d}px`,color:m},children:x})}),u.url&&t.jsx("img",{className:s.redactorImg,src:u.url,alt:"img"})]}),t.jsxs("div",{className:s.controls,children:[t.jsx("input",{className:`${s.text} ${s.inputAdmin}`,type:"text",value:x,onChange:e=>V(e.target.value),placeholder:"Введите текст"}),t.jsx("input",{className:`${s.size} ${s.inputAdmin}`,type:"number",value:d,onChange:e=>$(Number(e.target.value)),placeholder:"Размер шрифта"}),t.jsx("input",{className:s.color,type:"color",value:m,onChange:e=>F(e.target.value)}),t.jsxs("div",{children:[t.jsx("p",{children:"Начало анимации*кадры*"}),t.jsx("input",{className:`${s.text} ${s.inputAdmin}`,type:"text",value:f,onChange:e=>{R(Number(e.target.value))},placeholder:"Начало анимации"}),t.jsx("p",{children:"Конец анимации*кадры*"}),t.jsx("input",{className:`${s.text} ${s.inputAdmin}`,type:"text",value:h,onChange:e=>{A(Number(e.target.value))},placeholder:"Конец анимации"})]})]}),n.map((e,a)=>t.jsx(T,{index:a,block:e,listBoxItems:O,handleListBoxChange:I,removeBlock:P,t:B},e.id)),t.jsxs("div",{className:s.btnBox,children:[t.jsx(j,{className:s.adminRedactorButton,onClick:D,children:"Добавить фильтр"}),t.jsx(j,{isLoading:v.isPending,className:s.adminRedactorButton,onClick:L,children:"Отправить"})]})]})};export{re as default};
