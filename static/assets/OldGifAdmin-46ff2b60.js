import{u as L,m as U,l as w,g as J,r,j as s}from"./index-5e81b91c.js";import{B as d}from"./Button-1ab70214.js";import{s as a}from"./OldImageAdmin.module-21041e04.js";import{D as X}from"./cjs-39fee79f.js";import{l as Y,u as Z,G as ee,g as te,e as se}from"./dataImg-ad0e902f.js";import{u as ae,a as m,q as i}from"./queryClient-4e3f4a74.js";import{_ as g}from"./index-cd3c7b2d.js";import{L as ne}from"./ListFilter-770b5bdd.js";import{g as re}from"./getAdminGif-8fba910d.js";import"./ListBox-a88bdaf2.js";const xe=()=>{const R={country:"",language:"",currency:"",banner_format:"",banner_theme:""},z=L(re),A=U(),{full_picture_id:E}=w(),{t:I}=ae(),t=z.find(e=>e.full_picture_id===Number(E)),v=L(J),[q,y]=r.useState(),f=r.useRef(null),[l,S]=r.useState({x:0,y:0}),[j,k]=r.useState("Тест текст"),[p,N]=r.useState("30"),[x,P]=r.useState("#000000"),[C,B]=r.useState(1),[b,D]=r.useState(1e3),[c,_]=r.useState([{id:1,selectedValues:R}]);r.useEffect(()=>{t&&(N(t.size),P(t.color_text),S({x:t.left,y:t.top}),B(t.start_frame),D(t.end_frame),_([{id:1,selectedValues:{country:t.country||"",language:t.language||"",currency:t.value||"",banner_format:t.format||"",banner_theme:t.topic||""}}]))},[t]);const F=m({mutationFn:e=>Z(e.pictures),onSuccess:()=>{i.invalidateQueries({queryKey:["adminGif"]})},onError:e=>{g.error(e.message)}},i),V=m({mutationFn:e=>ee(e.token,e.full_picture_id),onSuccess:e=>{y(e)},onError:e=>{g.error(e.message)}},i),G=m({mutationFn:e=>te(e.full_picture_id),onSuccess:e=>{i.invalidateQueries({queryKey:["adminGif"]}),g.success(e.data)}},i),K=e=>{G.mutate({full_picture_id:e})},$=m({mutationFn:e=>se(e.token,e.full_picture_id),onSuccess:e=>{A(-1),i.invalidateQueries({queryKey:["adminGif"]}),g.success(e.Success)}},i),Q=e=>{$.mutate({token:v,full_picture_id:e})},T=(e,n)=>{S({x:n.x,y:n.y})},H=(e,n,h)=>{_(c.map(o=>o.id===e?{...o,selectedValues:{...o.selectedValues,[n]:h}}:o))},W=()=>{const e=f.current;if(e){const n=e.offsetWidth,h=e.offsetHeight,o=c.map(u=>({full_picture_id:t.full_picture_id,country:u.selectedValues.country,language:u.selectedValues.language,value:u.selectedValues.currency,format:u.selectedValues.banner_format,topic:u.selectedValues.banner_theme,color:x,left:l.x.toString(),right:(l.x+n).toString(),top:l.y.toString(),bottom:(l.y+h).toString(),size:p,start_frame:C,end_frame:b}));F.mutate({pictures:o})}},M=e=>{y(null),V.mutate({token:v,full_picture_id:e})},O=e=>_(c.filter(n=>n.id!==e));return s.jsxs("div",{className:a.redactorBox,children:[s.jsxs("div",{className:a.draggableImgBox,children:[s.jsx(X,{nodeRef:f,bounds:"parent",position:l,onDrag:T,children:s.jsx("div",{ref:f,className:a.draggableBox,style:{fontSize:`${p}px`,color:x},children:j})}),t.url&&s.jsx("img",{className:a.redactorImg,src:t.url,alt:"img"})]}),s.jsxs("div",{className:a.controls,children:[s.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:j,onChange:e=>k(e.target.value),placeholder:"Введите текст"}),s.jsx("input",{className:`${a.size} ${a.inputAdmin}`,type:"number",value:p,onChange:e=>N(e.target.value),placeholder:"Размер шрифта"}),s.jsx("input",{className:a.color,type:"color",value:x,onChange:e=>P(e.target.value)}),s.jsxs("div",{children:[s.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:C,onChange:e=>{B(Number(e.target.value))},placeholder:"Начало анимации"}),s.jsx("input",{className:`${a.text} ${a.inputAdmin}`,type:"text",value:b,onChange:e=>{D(Number(e.target.value))},placeholder:"Конец анимации"})]})]}),c.map((e,n)=>s.jsx(ne,{index:n,block:e,listBoxItems:Y,handleListBoxChange:H,removeBlock:O,t:I},e.id)),s.jsxs("div",{className:a.btnBox,children:[s.jsx(d,{isLoading:F.isPending,className:a.adminRedactorButton,onClick:W,children:"Изменить"}),s.jsx(d,{isLoading:G.isPending,className:a.adminRedactorButton,onClick:()=>K(t.full_picture_id),children:"Опубликовать"}),s.jsx(d,{isLoading:V.isPending,className:a.adminRedactorButton,onClick:()=>M(t.full_picture_id),children:"Demo"}),s.jsx(d,{isLoading:$.isPending,className:a.btnDelete,onClick:()=>Q(t.full_picture_id),children:"Удалить"})]}),s.jsx("img",{src:q,alt:""})]})};export{xe as default};
