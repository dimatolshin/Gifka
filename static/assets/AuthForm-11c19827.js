import{j as e,r as i,a as D,g as M,i as T,b as z,c as $,t as L,L as I,q as F,k as G,l as H}from"./index-95f7e09e.js";import{B as P}from"./Button-81d61278.js";import{u as R,t as B,L as U,R as V}from"./AuthType-bea5b160.js";import{a as Z,r as O}from"./authUser-8f8adb2a.js";import{u as q}from"./useTranslation-57b3bb4d.js";const J="_boxSwitch_1kdru_1",K="_btnSwitch_1kdru_4",Q="_stroke_1kdru_9",W="_lineBreack_1kdru_14",X="_and_1kdru_20",Y="_boxGoogle_1kdru_28",ee="_googleAuth_1kdru_28",se="_authDescr_1kdru_35",h={boxSwitch:J,btnSwitch:K,stroke:Q,lineBreack:W,and:X,boxGoogle:Y,googleAuth:ee,authDescr:se};function ae(){return e.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M13.9168 7.64424C13.9168 7.22181 13.8785 6.82077 13.813 6.43042H7.6394V8.84202H11.1742C11.0157 9.63341 10.5514 10.3018 9.86297 10.7563V12.3605H11.9718C13.2065 11.2429 13.9168 9.59598 13.9168 7.64424Z",fill:"#4285F4"}),e.jsx("path",{d:"M7.63954 13.9165C9.40966 13.9165 10.8902 13.339 11.972 12.3605L9.86311 10.7563C9.27308 11.1413 8.5246 11.3766 7.63954 11.3766C5.92953 11.3766 4.48175 10.2483 3.96273 8.72437H1.78833V10.3767C2.8646 12.4728 5.07725 13.9165 7.63954 13.9165Z",fill:"#34A853"}),e.jsx("path",{d:"M3.96266 8.72436C3.82608 8.33936 3.75506 7.92763 3.75506 7.49985C3.75506 7.07207 3.83155 6.66034 3.96266 6.27534V4.62305H1.78826C1.34027 5.4893 1.0835 6.46249 1.0835 7.49985C1.0835 8.53721 1.34027 9.51041 1.78826 10.3767L3.96266 8.72436Z",fill:"#FBBC05"}),e.jsx("path",{d:"M7.63954 3.62318C8.60655 3.62318 9.46975 3.94936 10.1527 4.58568L12.0211 2.75693C10.8902 1.71957 9.40966 1.08325 7.63954 1.08325C5.07725 1.08325 2.8646 2.527 1.78833 4.62311L3.96273 6.27541C4.48175 4.75145 5.92953 3.62318 7.63954 3.62318Z",fill:"#EA4335"})]})}const oe="_form_z9p43_1",te="_formTitle_z9p43_15",re="_btnSub_z9p43_21",ne="_boxForgot_z9p43_29",le="_forgotPass_z9p43_36",ce="_error_z9p43_44",p={form:oe,formTitle:te,btnSub:re,boxForgot:ne,forgotPass:le,error:ce};function ie(){var l,N;const[t,r]=i.useState(!1),[a,n]=i.useState(!1),m=D(M),w=T(),b=z(),_=()=>{r(s=>!s)},x=$({mutationFn:s=>Z(s.email,s.password),onSuccess:s=>{b(L.initAuthData(s)),S()}},F),{register:c,handleSubmit:j,formState:{errors:d},reset:S,setValue:u}=R({resolver:B(U)});i.useEffect(()=>{const s=localStorage.getItem("email"),k=localStorage.getItem("password");s&&k&&(u("email",s),u("password",k),n(!0))},[u]);const f=()=>{n(s=>!s)},y=s=>{a?(localStorage.setItem("email",s.email),localStorage.setItem("password",s.password)):(localStorage.removeItem("email"),localStorage.removeItem("password")),x.mutate({email:s.email,password:s.password})};return i.useEffect(()=>{m&&w("/")},[m]),e.jsxs("form",{className:p.form,onSubmit:j(y),children:[e.jsxs("label",{children:[e.jsx("span",{className:p.formTitle,children:"Email"}),e.jsx("input",{className:`input ${d.email?"border-danger":""}`,placeholder:"email@email.com",type:"email",autoComplete:"username",...c("email")}),d&&e.jsx("span",{className:p.error,children:(l=d.email)==null?void 0:l.message})]}),e.jsxs("label",{children:[e.jsxs("div",{className:p.boxForgot,children:[e.jsx("span",{className:p.formTitle,children:"Password"}),e.jsx(I,{to:"forgot",className:p.forgotPass,children:"Forgot Password?"})]}),e.jsxs("div",{className:`input max-w-72 ${d.password?"border-danger":""}`,"data-toggle-password":"true",children:[e.jsx("input",{autoComplete:"current-password",placeholder:"Enter Password",type:t?"text":"password",...c("password")}),e.jsx("div",{onClick:_,className:"btn btn-icon","data-toggle-password-trigger":"true",children:t?e.jsx("i",{className:"ki-outline ki-eye-slash toggle-password-active:block"}):e.jsx("i",{className:"ki-outline ki-eye toggle-password-active:hidden"})})]}),d&&e.jsx("span",{className:p.error,children:(N=d.password)==null?void 0:N.message})]}),e.jsxs("label",{className:"form-label flex items-center gap-2.5",children:[e.jsx("input",{className:"checkbox",name:"check",type:"checkbox",value:"1",checked:a,onChange:f}),"Remember me"]}),x.error&&e.jsx("span",{className:p.error,children:x.error.message}),e.jsx(P,{isLoading:x.isPending,className:p.btnSub,children:"Sign in"})]})}const me="_form_z9p43_1",de="_formTitle_z9p43_15",ue="_btnSub_z9p43_21",ge="_boxForgot_z9p43_29",he="_forgotPass_z9p43_36",pe="_error_z9p43_44",g={form:me,formTitle:de,btnSub:ue,boxForgot:ge,forgotPass:he,error:pe};function xe(){var s,k,E,A;q();const[t,r]=i.useState(!1),[a,n]=i.useState(!1),[m,w]=i.useState(!1),[b,_]=i.useState(null),[x,c]=i.useState(""),j=T(),d=()=>{r(o=>!o)},S=()=>{w(o=>!o)},u=$({mutationFn:o=>O(o.email,o.password,o.re_password,o.username),onSuccess:()=>{n(!0),_(null),N()},onError:o=>{const v=Object.keys(o).map(C=>`${C}: ${o[C]}`).join(", ");console.log(v),_(v)}},F),{register:f,handleSubmit:y,formState:{errors:l},reset:N}=R({resolver:B(V)});return i.useEffect(()=>{a&&!b&&(j("/auths/check",{state:{emailName:x}}),n(!1))},[a,b]),e.jsxs("form",{className:g.form,onSubmit:y(({email:o,password:v,confirmPassword:C})=>{u.mutate({email:o,password:v,re_password:C,username:o}),c(o)}),children:[e.jsxs("label",{children:[e.jsx("span",{className:g.formTitle,children:"Email"}),e.jsx("input",{autoComplete:"username",className:`input ${l.email?"border-danger":""}`,placeholder:"email@email.com",type:"email",...f("email")}),l&&e.jsx("span",{className:g.error,children:(s=l.email)==null?void 0:s.message})]}),e.jsxs("label",{children:[e.jsx("span",{className:g.formTitle,children:"Password"}),e.jsxs("div",{className:`input max-w-72 ${l.password?"border-danger":""}`,"data-toggle-password":"true",children:[e.jsx("input",{autoComplete:"new-password",placeholder:"Enter Password",type:t?"text":"password",...f("password")}),e.jsx("div",{onClick:d,className:"btn btn-icon","data-toggle-password-trigger":"true",children:t?e.jsx("i",{className:"ki-outline ki-eye-slash toggle-password-active:block"}):e.jsx("i",{className:"ki-outline ki-eye toggle-password-active:hidden"})})]}),l&&e.jsx("span",{className:g.error,children:(k=l.password)==null?void 0:k.message})]}),e.jsxs("label",{children:[e.jsx("span",{className:g.formTitle,children:"Confirm Password"}),e.jsxs("div",{className:`input max-w-72 ${l.confirmPassword?"border-danger":""}`,"data-toggle-password":"true",children:[e.jsx("input",{autoComplete:"new-password",placeholder:"Re-enter Password",type:m?"text":"password",...f("confirmPassword")}),e.jsx("div",{onClick:S,className:"btn btn-icon","data-toggle-password-trigger":"true",children:m?e.jsx("i",{className:"ki-outline ki-eye-slash toggle-password-active:block"}):e.jsx("i",{className:"ki-outline ki-eye toggle-password-active:hidden"})})]}),l&&e.jsx("span",{className:g.error,children:(E=l.confirmPassword)==null?void 0:E.message})]}),e.jsxs("label",{className:"form-label flex items-center gap-2.5",children:[e.jsx("input",{...f("consent"),className:"checkbox",type:"checkbox",defaultChecked:!0}),e.jsx("p",{children:"I accept Terms & Conditions"})]}),l&&e.jsx("span",{className:g.error,children:(A=l.consent)==null?void 0:A.message}),u.error&&e.jsx("span",{className:g.error,children:u.error.message}),e.jsx(P,{isLoading:u.isPending,type:"submit",className:g.btnSub,children:"Sign up"})]})}const fe="https://bwcreatorhub.com";function we(t){return G.get("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}).then(r=>{const a=r.data.email,n=r.data.given_name,m=r.data.family_name,w=r.data.sub;return{email:a,username:n,lastname:m,id:w}}).catch(r=>{if(r)throw new Error("Ошибка")})}function be(t,r){return G.post(`${fe}/api/google_auth/`,{email:t,username:r}).then(a=>{const n=a.data.token;return console.log(n),n}).catch(a=>{const n=Object.keys(a.response.data).map(m=>`${a.response.data[m]}`).join(", ");throw new Error(n)})}function ve(){const[t,r]=i.useState("auth"),[a,n]=i.useState(),m=z(),w=()=>{r(c=>c==="register"?"auth":"register")},b=$({mutationFn:c=>be(c.email,c.username),onSuccess:c=>{m(L.initAuthData(c))}},F);i.useEffect(()=>{a&&b.mutate({email:a.email,username:a.email})},[a]);const x=H({onSuccess:async c=>{const j=await we(c);if(j){const{email:d,username:S,lastname:u,id:f}=j;n({email:d,username:S,lastname:u,id:f})}}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:h.boxSwitch,children:[e.jsx("h1",{children:t==="auth"?"Sign in":"Sign up"}),e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("p",{className:"mr-1",children:t==="auth"?"Need an account?":"Already have an Account?"}),e.jsx(P,{className:h.btnSwitch,onClick:w,children:t==="auth"?"Sign up":"Sign in"})]})]}),e.jsx("div",{className:h.boxGoogle,children:e.jsxs(P,{onClick:()=>x(),className:h.googleAuth,children:[e.jsx(ae,{}),e.jsx("p",{className:h.authDescr,children:"Use Google"})]})}),e.jsxs("div",{className:h.stroke,children:[e.jsx("div",{className:h.lineBreack}),e.jsx("p",{className:h.and,children:"OR"}),e.jsx("div",{className:h.lineBreack})]}),t==="auth"?e.jsx(ie,{}):e.jsx(xe,{})]})}export{ve as default};
